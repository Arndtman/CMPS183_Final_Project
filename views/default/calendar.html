{{extend 'layout.html'}}
    <link href="{{=URL('static','css/myapp.css')}}" rel="stylesheet" type="text/css"/>
    <link href="{{=URL('static','css/calendar.css')}}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css"/>
    <link href="{{=URL('static','css/form.css')}}" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
<head>
    <meta charset='utf-8' />
    <link href="{{=URL('static','fullcalendar/fullcalendar.min.css')}}" rel="stylesheet" type="text/css"/>
    <link href="{{=URL('static','fullcalendar/fullcalendar.print.min.css')}}" rel="stylesheet" media="print" type="text/css"/>
    <script src='/final2/static/fullcalendar/lib/moment.min.js'></script>
    <script src='/final2/static/fullcalendar/lib/jquery.min.js'></script>
    <script src='/final2/static/fullcalendar/fullcalendar.min.js'></script>
    <script src='/final2/static/fullcalendar/gcal.min.js'></script>
    <script type="text/javascript">

      $(document).ready(function() {

        var date = new Date();
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();

        $('#calendar').fullCalendar({
          editable: false,

          header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,listMonth'
          },

          displayEventTime: false, // don't show the time column in list view

          // Google Calendar API key
          googleCalendarApiKey: 'AIzaSyBcJRtz5sngTqRQij2xWuMssI8PPPquF8c',

          // US Holidays
          events: 'en.usa#holiday@group.v.calendar.google.com',

          // Meal events
          events: [
              // loop though all the events/memos
              // TODO: the error occurs in 'checklist' I'm having trouble linking the database to the calendar
              // What I'm trying to do is to retrieve all the memos and take the title and time/date to print on the calendar
              {{for row in enumerate(checklist):}}
                {{if row!=0:}}, {{pass}}
                {
                    // these fields
                    title: '{{=row.title}}',
                    allDay: false,
                    start: new Date('{{=row.datetime.strftime('%B %d, %Y %H:%M:%S')}}'),
                    end: new Date('{{=row.time_of_event.strftime('%B %d, %Y %H:%M:%S')}}'),
                    // url: '{{=URL('memo_read', args=row.id)}}'
                }
              {{pass}}
           ]


          eventClick: function(event) {
            // opens events in a popup window
            window.open(event.url, 'gcalevent', 'width=700,height=600');
            return false;
          },

          loading: function(bool) {
            $('#loading').toggle(bool);
          }

        });

      });

    </script>
    <style>

      body {
        margin: 40px 10px;
        padding: 5px;
        padding-bottom: 10px;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        font-size: 14px;
        overflow-x: hidden;
      }

      #loading {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
      }

      #calendar {
        max-width: 900px;
        margin: 0 auto;
      }

    </style>
</head>



<div class="main_content center">

    <h1 class="ui center aligned icon header">
        <br/>
        <i class="circular calendar icon"></i>
        Calendar of Meals
    </h1>

    {{if auth.user is not None:}}
    <div id='loading'>loading...</div>

    <!-- Calendar is placed here -->
    <div id='calendar'></div>

    {{else:}}
    <h2 class="center">Log in to see your calendar of upcoming meals!</h2>

    {{pass}}
</div>

<script src="{{=URL('static','js/default_index.js')}}"></script>
